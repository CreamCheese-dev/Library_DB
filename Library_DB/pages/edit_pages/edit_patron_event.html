<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Patron Event</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <h1>Edit Patron Event</h1>
    <form id="editEventForm">
        <label for="eventName">Event Name:</label><br>
        <input type="text" id="eventName" name="eventName" required><br>
        <label for="eventDate">Event Date:</label><br>
        <input type="datetime-local" id="eventDate" name="eventDate" required><br>
        <label for="description">Description:</label><br>
        <textarea id="description" name="description"></textarea><br>
        <label for="attendance">Attendance:</label><br>
        <input type="number" id="attendance" name="attendance"><br>
        <label for="staffId">Staff:</label><br>
        <select id="staffId" name="staffId" required></select><br><br>
        <button type="button" onclick="updateEvent()">Update</button>
        <button type="button" onclick="goBack()">Go Back</button>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetchEventDetails();
            fetchStaff();
        });

        function fetchEventDetails() {
            const eventId = new URLSearchParams(window.location.search).get('eventId');
            fetch(`http://read-renaissance.com/api/events`)
                .then(response => response.json())
                .then(events => {
                    const event = events.find(e => e.eventID == eventId);
                    if (event) {
                        document.getElementById('eventName').value = event.eventName;
                        document.getElementById('eventDate').value = event.event_Date.substring(0, 16);
                        document.getElementById('description').value = event.description;
                        document.getElementById('attendance').value = event.attendance;
                        document.getElementById('staffId').value = event.staffID;
                    }
                })
                .catch(error => console.error('Error fetching event details:', error));
        }

        function fetchStaff() {
            fetch('http://read-renaissance.com/api/staff')
                .then(response => response.json())
                .then(staffMembers => {
                    const staffSelect = document.getElementById('staffId');
                    staffSelect.innerHTML = ''; // Clear existing options
                    staffMembers.forEach(staff => {
                        const option = document.createElement('option');
                        option.value = staff.staffId;
                        option.text = `${staff.firstName} ${staff.lastName}`;
                        staffSelect.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching staff:', error));
        }

        function updateEvent() {
            const eventId = new URLSearchParams(window.location.search).get('eventId');
            const form = document.getElementById('editEventForm');
            const eventData = {
                eventName: form.eventName.value,
                event_Date: form.eventDate.value,
                description: form.description.value,
                attendance: parseInt(form.attendance.value),
                staffID: parseInt(form.staffId.value)
            };

            fetch(`http://read-renaissance.com/api/events/${eventId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(eventData)
            })
            .then(response => response.json())
            .then(data => {
                alert('Event updated successfully!');
                window.location.href = '../view_patron_events.html';
            })
            .catch(error => console.error('Error updating event:', error));
        }

    function goBack() {
        window.history.back();
    }
    </script>
</body>
</html>
